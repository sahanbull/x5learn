import os
import sys


from x5learn_server._config import DB_ENGINE_URI, PASSWORD_SECRET
from x5learn_server.db.database import Base, get_or_create_db
db_session = get_or_create_db(DB_ENGINE_URI)
from x5learn_server.models import Oer


# This is a temporary script to resolve issue #342


old_id_to_material_id = {
    8686: 10593,
    8969: 33545,
    8730: 17994,
    9404: 33713,
    8804: 39661,
    8668: 27466,
    9526: 7833,
    9046: 33118,
    8845: 84508,
    9178: 37685,
    8899: 29486,
    9982: 1875,
    8920: 18901,
    9678: 30650,
    9131: 81613,
    9610: 35424,
    9931: 88931,
    8764: 40522,
    9788: 27582,
    8705: 2469,
    8711: 10083,
    9668: 12770,
    8955: 102591,
    8931: 17999,
    8758: 77029,
    8731: 18060,
    8854: 40524,
    8941: 73622,
    9157: 19706,
    9051: 23720,
    8987: 10679,
    9066: 1473,
    8765: 31494,
    9795: 18328,
    9390: 30202,
    9975: 88511,
    9003: 17679,
    9488: 12003,
    8810: 39697,
    9032: 73623,
    9297: 87631,
    9204: 7545,
    8886: 18846,
    8981: 37770,
    9037: 7751,
    9637: 15059,
    8842: 77513,
    8892: 23345,
    8691: 7658,
    9171: 8622,
    9932: 82134,
    8795: 7105,
    8917: 5437,
    8697: 16125,
    9272: 77574,
    9900: 19169,
    9160: 33337,
    9407: 80767,
    8916: 80248,
    8851: 35241,
    8947: 14830,
    8951: 73144,
    8983: 77919,
    8945: 73631,
    8974: 37773,
    9036: 79965,
    9707: 11693,
    9745: 10044,
    9013: 13553,
    9507: 74761,
    8672: 89832,
    8682: 18596,
    9556: 19024,
    8812: 34340,
    9506: 37445,
    8873: 77127,
    8993: 26184,
    9024: 79966,
    9579: 25418,
    9031: 73143,
    9430: 77669,
    9007: 80692,
    8938: 74544,
    8877: 15703,
    8707: 11418,
    9803: 34090,
    9548: 76457,
    8867: 14763,
    9629: 18260,
    8961: 14109,
    8923: 29729,
    9001: 17792,
    9458: 78270,
    8816: 1831,
    8744: 73782,
    8740: 13555,
    9134: 76674,
    8677: 32874,
    9783: 87687,
    8712: 77315,
    9317: 29488,
    9617: 81975,
    9521: 12583,
    8820: 40195,
    9552: 77589,
    9738: 3646,
    9264: 5128,
    8915: 3367,
    9201: 8072,
    9300: 8422,
    9200: 8321,
    8688: 1024,
    8749: 87423,
    8933: 32182,
    9833: 74909,
    9922: 37540,
    9869: 76679,
    9399: 11959,
    9018: 2472,
    8875: 14639,
    9341: 16160,
    8896: 76137,
    8906: 40196,
    8950: 19541,
    9393: 30337,
    9021: 17822,
    9363: 81513,
    9799: 41497,
    8977: 9522,
    9864: 13808,
    8903: 73078,
    8788: 40498,
    8988: 10836,
    9951: 79707,
    9092: 1458,
    9530: 3846,
    9891: 27339,
    8805: 35772,
    9544: 20385,
    9670: 13522,
    8709: 77236,
    9345: 18065,
    8967: 35160,
    9199: 82437,
    8771: 24472,
    9542: 76872,
    8798: 77950,
    9211: 80649,
    9422: 22115,
    8778: 14815,
    8761: 17580,
    9627: 82432,
    8713: 38102,
    8839: 79629,
    9462: 78470,
    8922: 1375,
    9009: 13196,
    8829: 74314,
    9426: 88485,
    8982: 9887,
    8818: 76161,
    9262: 87671,
    8757: 16568,
    8960: 74656,
    8942: 26530,
    8796: 80135,
    9295: 27467,
    8865: 76607,
    8978: 75426,
    9889: 8312,
    8861: 14293,
    8911: 102570,
    9371: 80860,
    9461: 78655,
    8751: 13554,
    9358: 77599,
    8858: 753,
    9014: 40615,
    8976: 40779,
    8846: 79969,
    9636: 4583,
    9381: 7332,
    8840: 18173,
    8748: 26413,
    9464: 3177,
    8774: 32884,
    8994: 2167,
    9420: 79239,
    9994: 13642,
    8844: 73810,
    9918: 89928,
    9460: 34490,
    9061: 30603,
    8990: 80272,
    9060: 26529,
    8847: 25602,
    8685: 13256,
    8968: 74162,
    9698: 13806,
    8747: 2481,
    8766: 6721,
    8702: 8855,
    8912: 31045,
    9684: 37065,
    8781: 130,
    8708: 5274,
    8755: 2105,
    8779: 89864,
    9129: 88657,
    8939: 1506,
    8756: 15713,
    8850: 4573,
    9583: 88932,
    9339: 19724,
    9090: 6702,
    9510: 77068,
    9894: 14006,
    8986: 75290,
    9640: 76769,
    9127: 7204,
    9567: 8453,
    9351: 32414,
    8803: 78118,
    9721: 37437,
    8859: 597,
    8673: 7362,
    9835: 80787,
    9758: 77522,
    8884: 18460,
    8882: 507,
    9006: 77834,
    9069: 6583,
    9827: 32366,
    8992: 1546,
    9736: 8262,
    8738: 88296,
    8909: 31349,
    9699: 15352,
    8733: 78062,
    9664: 73667,
    8797: 77913,
    9337: 29373,
    8801: 36224,
    9749: 3635,
    9499: 18575,
    8726: 17938,
    9400: 19516,
    8792: 17051,
    9509: 77793,
    9616: 12028,
    9478: 36432,
    8853: 84122,
    9340: 27957,
    9195: 16189,
    9755: 80886,
    9238: 87460,
    9604: 78483,
    8728: 13255,
    9068: 23652,
    8715: 8963,
    9784: 10263,
    9423: 21743,
    9229: 88573,
    8814: 16668,
    8943: 81385,
    8718: 36871,
    9419: 34903,
    8843: 84352,
    8838: 14826,
    8849: 24157,
    8680: 10035,
    8868: 36785,
    9969: 17271,
    8962: 6088,
    9319: 88676,
    9257: 16760,
    8973: 8865,
    9058: 8660,
    8926: 89353,
    9273: 16537,
    9779: 10846,
    8700: 33805,
    8852: 26003,
    9025: 13257,
    9554: 32575,
    8826: 1893,
    9023: 79912,
    8679: 30389,
    9515: 1916,
    8719: 537,
    8676: 34519,
    9166: 34750,
    9075: 17380,
    9251: 81091,
    9222: 87646,
    8898: 31715,
    8823: 10530,
    9145: 80694,
    8895: 79935,
    9202: 3758,
    8769: 34778,
    9854: 74633,
    8753: 2475,
    9941: 73428,
    9524: 33775,
    9663: 14654,
    9782: 80856,
    9781: 9077,
    8675: 12972,
    9107: 33111,
    8975: 33950,
    9350: 78481,
    8897: 7207,
    8965: 74166,
    9537: 22516,
    8763: 89335,
    9421: 75049,
    9631: 13551,
    9038: 80254,
    9005: 17681,
    9553: 12359,
    9181: 33322,
    9428: 30044,
    8746: 2353,
    8783: 25082,
    9098: 37737,
    9292: 10982,
    9522: 29868,
    8902: 26701,
    9327: 5817,
    8693: 75883,
    8706: 15591,
    8690: 15003,
    9661: 31266,
    8799: 87639,
    9409: 75143,
    8742: 2106,
    8890: 12013,
    9248: 89884,
    8835: 13594,
    9856: 102590,
    8879: 14203,
    9981: 21221,
    9879: 18752,
    9117: 87458,
    9508: 4607,
    8913: 31251,
    9564: 12435,
    8927: 29634,
    9356: 35183,
    9112: 4571,
    8732: 78202,
    8768: 24159,
    9214: 9695,
    9834: 77709,
    9137: 7281,
    9849: 75579,
    8784: 73290,
    8789: 40703,
    8874: 39375,
    8929: 88575,
    8785: 40193,
    9146: 76784,
    8928: 73077,
    8918: 88547,
    8770: 1573,
    8678: 81092,
    9693: 73621,
    8866: 17320,
    8985: 81221,
    9376: 18234,
    8830: 6470,
    9491: 7006,
    8777: 89861,
    8880: 76891,
    9489: 76632,
    9062: 87383,
    9004: 7547,
    8670: 18298,
    8901: 29388,
    9435: 88509,
    8717: 7209,
    9115: 87461,
    9830: 37692,
    9254: 81386,
    9231: 27034,
    8924: 74504,
    9147: 29653,
    9355: 30580,
    9039: 89345,
    8767: 11292,
    8762: 80785,
    9388: 78506,
    8819: 40790,
    8720: 17959,
    9020: 8230,
    8782: 40525,
    8791: 14371,
    9936: 73260,
    9927: 17297,
    9917: 87425,
    9016: 25139,
    9301: 75646,
    8786: 89866,
    8741: 2352,
    8760: 2289,
    9451: 74604,
    8780: 88501,
    9389: 12508,
    9163: 73129,
    9142: 74238,
    8716: 7208,
    9970: 13153,
    8703: 35755,
    9954: 25426,
    9493: 37049,
    9872: 76745,
    8888: 18810,
    9577: 80540,
    9008: 1209,
    9667: 33834,
    8862: 15670,
    9395: 76441,
    9236: 36054,
    9438: 12258,
    9012: 6765,
    8905: 29232,
    8745: 14166,
    9634: 600,
    8723: 77982,
    9361: 80703,
    8889: 14415,
    8963: 24986,
    8735: 18452,
    9387: 13955,
    9652: 77518,
    8802: 18602,
    9042: 11480,
    9671: 87413,
    9113: 32578,
    9543: 8276,
    9143: 16510,
    9650: 78468,
    8837: 37147,
    8687: 28509,
    9791: 10185,
    9205: 17175,
    8807: 40000,
    8944: 81350,
    8908: 29960,
    8817: 3444,
    9899: 34925,
    8946: 80329,
    8949: 77864,
    8904: 7051,
    8696: 9684,
    8883: 84195,
    9647: 74064,
    9270: 81063,
    8710: 35190,
    9210: 16143,
    9884: 36239,
    8725: 18367,
    8940: 73616,
    8692: 35712,
    8694: 15784,
    8671: 76676,
    8750: 2102,
    8737: 17869,
    8827: 1801,
    9590: 36269,
    9343: 406,
    9244: 32441,
    9857: 19423,
    9453: 82521,
    9602: 87317,
    9088: 11847,
    8979: 15699,
    9531: 27525,
    8921: 75473,
    8870: 14410,
    9831: 82169,
    9148: 12570,
    9434: 78238,
    9221: 10188,
    9759: 28523,
    9988: 13772,
    8952: 11938,
    8775: 7253,
    9377: 9942,
    9705: 40352,
    9837: 35780,
    8998: 6889,
    9172: 3158,
    8831: 26535,
    9513: 7995,
    9235: 33738,
    9591: 87229,
    8934: 26629,
    9881: 26780,
    9540: 28272,
    9946: 27241,
    9180: 36476,
    9190: 33534,
    9118: 74219,
    9708: 11611,
    8699: 8975,
    9022: 25860,
    9293: 30999,
    8695: 15568,
    8681: 15149,
    8848: 133387,
    8773: 12103,
    9383: 28887,
    9011: 4917,
    8860: 36673,
    8736: 87609,
    8828: 4973,
    8724: 5841,
    8948: 33451,
    8900: 80148,
    9103: 30087,
    9571: 19147,
    8935: 80273,
    9756: 33625,
    8925: 89103,
    9220: 10264,
    9055: 74111,
    8841: 26449,
    9314: 37443,
    9308: 34155,
    9523: 28274,
    8871: 31552,
    9987: 75441,
    9801: 992,
    8857: 426,
    8991: 25385,
    9197: 16512,
    8984: 41359,
    9071: 26422,
    9546: 28882,
    8956: 74636,
    9410: 7993,
    8869: 12212,
    8891: 31857,
    8980: 31199,
    8910: 27527,
    9638: 87444,
    8833: 40257,
    8856: 26098,
    9740: 5135,
    8964: 40455,
    9101: 13390,
    9691: 3425,
    9307: 30388,
    8834: 25380,
    8806: 39657,
    8894: 74654,
    8721: 18041,
    9518: 8839,
    9378: 22055,
    8864: 26881,
    9588: 8542,
    9030: 32004,
    9796: 3847,
    8855: 36439,
    8881: 87209,
    8958: 74800,
    8714: 7752,
    8878: 15678,
    8824: 74667,
    9968: 29972,
    8953: 13380,
    8930: 1871,
    8989: 32022,
    9196: 16084,
    9207: 34373,
    9369: 77674,
    8739: 13556,
    9017: 2357,
    9568: 4723,
    9305: 29534,
    9744: 74391,
    8954: 102592,
    9808: 21642,
    8811: 2952,
    8727: 74240,
    8907: 31048,
    9002: 77498,
    8999: 81489,
    8932: 78094,
    8996: 21150,
    9482: 76677,
    9859: 12622,
    8794: 2356,
    9619: 18687,
    8936: 39943,
    9850: 32631,
    8734: 12822,
    9267: 88921,
    8787: 40556,
    9448: 88935,
    8722: 18193,
    8669: 1870,
    9757: 17448,
    9778: 18025,
    9015: 34696,
    9123: 31593,
    9940: 421,
    9067: 1393,
    8957: 6283,
    9401: 12521,
    9754: 25520,
    9089: 1327,
    9612: 35828,
    9794: 78185,
    8684: 13638,
    8815: 87368,
    9909: 76310,
    9912: 82289,
    8729: 12002,
    9992: 80380,
    9447: 14831,
    9895: 5735,
    8937: 77346,
    8893: 23344,
    8683: 18302,
    9079: 63349,
    8790: 26558,
    9726: 37476,
    9743: 3588,
    9122: 12238,
    9585: 8343,
    9816: 29866,
    9541: 34624,
    8813: 6042,
    8674: 30871,
    9189: 77515,
    9947: 7841,
    8832: 84266,
    8970: 994,
    9052: 81514,
    9323: 19274,
    8808: 40037,
    8959: 1396,
    9433: 7093,
    9539: 7816,
    9353: 73426,
    8759: 29302,
    8972: 1114,
    8689: 75061,
    9495: 29299,
    9326: 6236,
    8754: 2168,
    8876: 37097,
    9256: 7273,
    9457: 6703,
    9252: 76778,
    8701: 77454,
    9218: 88493,
    9048: 74852,
    8995: 78196,
    9498: 80108,
    8704: 8894,
    9821: 36613,
    9274: 6479,
    9905: 88602,
    8809: 80058,
    8971: 9141,
    9767: 75208,
    8793: 6252,
    9259: 37725,
    8698: 9831,
    8772: 84985,
    8752: 26177,
    8800: 35951,
    8919: 78473,
    8822: 33835,
    8863: 40612,
    9700: 75611,
    8914: 30161,
    8887: 78333,
    8872: 24317,
    9019: 40535,
    9035: 36457,
    8836: 36720,
    9010: 17766,
    9000: 37485,
    8825: 73329,
    9331: 3585,
    9330: 73434,
    9600: 88942,
    9165: 27119,
    8997: 78100,
    8743: 40225,
    8776: 88958,
    8966: 35229,
    9729: 6481,
    9360: 77550,
    9525: 81243}

oers = Oer.query.all()

for filename in os.listdir('/home/ucl/data/static_bak/sprite_sheets/'):
    print('#', filename)
    old_oer_id = int(filename.split('_')[1])
    # print('old_oer_id', old_oer_id)
    try:
        material_id = old_id_to_material_id[old_oer_id]
    except KeyError:
        print('# failed:', old_oer_id)
        continue
    # print('material_id', material_id)
    matches = [ oer for oer in oers if oer.data['material_id'] == material_id or oer.data['material_id'] == str(material_id) ]
    if len(matches)>0:
        oer = matches[0]
        new_oer_id = oer.id
        # print('new_oer_id', new_oer_id)
        print("cp ../data/static_bak/sprite_sheets/"+filename+" ../data/static/sprite_sheets/sprite_"+str(new_oer_id)+"_10x10_332x175.jpg; echo "+str(material_id)+";")
